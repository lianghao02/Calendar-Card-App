<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每週日曆 | Weekly Calendar</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-top">
            <h1>
                <span class="icon">📅</span>
                <span id="current-month-year">2026 年 1 月</span>
            </h1>
            <div class="controls">
                <div class="view-toggle">
                    <button class="btn-toggle" id="view-week">週</button>
                    <button class="btn-toggle active" id="view-month">月</button>
                </div>
                <div class="nav-controls">
                    <button class="btn-icon" id="select-mode-btn" title="多選模式 (選擇日期分享)">☑️</button>
                    <div class="divider" style="width: 1px; height: 24px; background: #cbd5e1; margin: 0 0.5rem;"></div>
                    <button class="btn-icon" id="share-btn" title="分享行程">📤</button>
                    <button class="btn-icon" id="prev-btn" title="上一頁">&lt;</button>
                    <button class="btn-primary" id="today-btn">今天</button>
                    <button class="btn-icon" id="next-btn" title="下一頁">&gt;</button>
                </div>
            </div>
        </div>
        
        <div class="smart-input-container">
            <textarea id="smart-input" class="smart-input" rows="1" placeholder="💡 智慧輸入：貼上多行內容..."></textarea>
            <button id="smart-submit-btn" class="btn-send" title="送出解析">➤</button>
        </div>
    </header>

    <main class="calendar-container" id="calendar-grid">
        <!-- Day Cards will be generated here by JS -->
    </main>

    <!-- Selected Day Events (Mobile Split View) -->
    <div id="selected-day-events" class="selected-day-events">
        <!-- Events for the selected day will appear here -->
    </div>

    <!-- Modal for adding/editing events -->
    <div class="modal-overlay" id="event-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">新增事件</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">活動標題 (Title)</label>
                    <input type="text" class="input-field" id="event-input" placeholder="輸入標題 (例如：週二夜來香)...">
                </div>
                 <div class="input-group">
                    <label class="input-label">時間 (Time)</label>
                    <input type="text" class="input-field" id="event-time" placeholder="例如：10:00, 20:00 或留空">
                </div>
                <div class="input-group">
                    <label class="input-label">重複設定 (Recurrence)</label>
                    <select class="input-field" id="event-recurrence">
                        <option value="none" selected>不重複</option>
                        <option value="weekly_current_month">每週 (直到本月底)</option>
                        <option value="weekly_3_month">每週 (未來 3 個月)</option>
                        <option value="custom">自訂結束日期...</option>
                    </select>
                    <div id="recurrence-info" style="font-size: 0.85rem; color: #6366f1; margin-top: 0.5rem; display: none;"></div>
                </div>
                <div class="input-group" id="recurrence-end-date-group" style="display:none;">
                    <label class="input-label">結束日期 (End Date)</label>
                    <input type="date" class="input-field" id="event-recurrence-end">
                </div>
                <div class="input-group">
                    <label class="input-label">地點 (Location)</label>
                    <input type="text" class="input-field" id="event-location" placeholder="輸入地點...">
                </div>
                <div class="input-group">
                    <label class="input-label">附註 (Note)</label>
                    <textarea class="input-field" id="event-description" rows="3" placeholder="詳細內容、備註..."></textarea>
                </div>
                <div class="input-group">
                    <label class="input-label">相關連結 (Link)</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="input-field" id="event-link" placeholder="https://..." style="flex: 1;">
                        <button type="button" id="open-link-btn" class="btn-primary" style="padding: 0 1rem; background-color: #6366f1;">開啟</button>
                    </div>
                </div>
                <input type="hidden" id="selected-date">
            </div>
            <div class="modal-footer">
                <button class="btn-danger" id="delete-btn" style="margin-right: auto; display: none; background-color: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;">刪除</button>
                <button class="btn-cancel" id="cancel-btn">取消</button>
                <button class="btn-primary" id="save-btn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Event Selection Modal (Mobile > 1 event) -->
    <div class="modal-overlay" id="event-list-modal-overlay" style="z-index: 2000;">
        <div class="modal" style="max-height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 class="modal-title" id="event-list-title">選擇行程</h3>
                <button class="btn-icon" id="close-event-list-modal">✕</button>
            </div>
            <div class="modal-body" id="event-list-container" style="overflow-y: auto; flex: 1; padding: 1rem 0;">
                <!-- List injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="add-from-list-btn" style="width:100%">+ 新增此日行程</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="share-modal-overlay">
        <div class="modal share-modal">
            <div class="modal-header">
                <h2 class="modal-title">分享行程</h2>
                <button class="close-modal" id="close-share-modal">&times;</button>
            </div>
            <div class="share-preview-container">
                <label class="input-label">內容預覽</label>
                <textarea id="share-text-preview" readonly></textarea>
            </div>
            <div class="share-actions">
                <button class="social-btn btn-line" id="share-line">
                    <span class="icon">💬</span> LINE
                </button>
                <button class="social-btn btn-messenger" id="share-messenger">
                    <span class="icon">⚡</span> Messenger
                </button>
                <button class="social-btn btn-copy" id="share-copy">
                    <span class="icon">📋</span> 複製文字
                </button>
            </div>
        </div>
    </div>

    <script src="script.js?v=1.4"></script>
</body>
</html>
